---
title: "2022 DHS Data Extraction"
author: "Anita Makori"
date: "2023-01-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Prep
```{r}
require(pacman)
p_load(docxtractr)
p_load(dplyr)
p_load(tidyverse)
p_load(ggiraph)

# import all the tables
dhs2022report <- read_docx("2022KDHSKIR_KNBS.docx") 

# number of tables in the report
docx_tbl_count(dhs2022report)
tbls <- docx_extract_all_tbls(dhs2022report, trim = T, guess_header = T)
```

## 3.13	Child Nutritional Status

### Table 14: Nutritional status of children
```{r}
## by age 
nut_age_hfa <- tbls[[52]]%>%
  slice(6:11,13,14) %>%
  dplyr::select(V1:V5)%>%
  dplyr::rename(Age = V1, perc_below3sd = V2, perc_below2sd = V3, zscore= V4, no = V5)%>%
  dplyr::mutate(indicator = "HFA")

nut_age_wfh <- tbls[[52]]%>%
  slice(6:11,13,14) %>%
  dplyr::select(V1,V6,V7,V9,V10)%>%
  dplyr::rename(Age = V1, perc_below3sd = V6, perc_below2sd = V7, zscore= V9, no = V10)%>%
  dplyr::mutate(indicator = "WFH")

nut_age_wfa <- tbls[[52]]%>%
  slice(6:11,13,14) %>%
  dplyr::select(V1,V11:V14)%>%
  dplyr::rename(Age = V1, perc_below3sd = V11, perc_below2sd = V12, zscore= V13, no = V14)%>%
  dplyr::mutate(indicator = "WFA")

nut_age <- dplyr::bind_rows(nut_age_hfa, nut_age_wfh, nut_age_wfa)
write_csv(nut_age, "table14_nutr_status_by_age.csv")

## by sex
nut_sex_hfa <- tbls[[52]]%>%
  slice(17:18) %>%
  dplyr::select(V1:V5)%>%
  dplyr::rename(Sex = V1, perc_below3sd = V2, perc_below2sd = V3, zscore= V4, no = V5)%>%
  dplyr::mutate(indicator = "HFA")

nut_sex_wfh <- tbls[[52]]%>%
  slice(17:18) %>%
  dplyr::select(V1,V6,V7,V9,V10)%>%
  dplyr::rename(Sex = V1, perc_below3sd = V6, perc_below2sd = V7, zscore= V9, no = V10)%>%
  dplyr::mutate(indicator = "WFH")

nut_sex_wfa <- tbls[[52]]%>%
  slice(17:18) %>%
  dplyr::select(V1,V11:V14)%>%
  dplyr::rename(Sex = V1, perc_below3sd = V11, perc_below2sd = V12, zscore= V13, no = V14)%>%
  dplyr::mutate(indicator = "WFA")

nut_sex <- dplyr::bind_rows(nut_sex_hfa, nut_sex_wfh, nut_sex_wfa)
write_csv(nut_sex, "table14_nutr_status_by_sex.csv")

## by residence
nut_res_hfa <- tbls[[52]]%>%
  slice(26:27) %>%
  dplyr::select(V1:V5)%>%
  dplyr::rename(Residence = V1, perc_below3sd = V2, perc_below2sd = V3, zscore= V4, no = V5)%>%
  dplyr::mutate(indicator = "HFA")

nut_res_wfh <- tbls[[52]]%>%
  slice(26:27) %>%
  dplyr::select(V1,V6,V7,V9,V10)%>%
  dplyr::rename(Residence = V1, perc_below3sd = V6, perc_below2sd = V7, zscore= V9, no = V10)%>%
  dplyr::mutate(indicator = "WFH")

nut_res_wfa <- tbls[[52]]%>%
  slice(26:27) %>%
  dplyr::select(V1,V11:V14)%>%
  dplyr::rename(Residence = V1, perc_below3sd = V11, perc_below2sd = V12, zscore= V13, no = V14)%>%
  dplyr::mutate(indicator = "WFA")

nut_res <- dplyr::bind_rows(nut_res_hfa, nut_res_wfh, nut_res_wfa)
write_csv(nut_res, "table14_nutr_status_by_residence.csv")

## by mot edu
nut_motedu_hfa <- tbls[[52]]%>%
  slice(30:33) %>%
  dplyr::select(V1:V5)%>%
  dplyr::rename(`Mother's education` = V1, perc_below3sd = V2, perc_below2sd = V3, zscore= V4, no = V5)%>%
  dplyr::mutate(indicator = "HFA")

nut_motedu_wfh <- tbls[[52]]%>%
  slice(30:33) %>%
  dplyr::select(V1,V6,V7,V9,V10)%>%
  dplyr::rename(`Mother's education` = V1, perc_below3sd = V6, perc_below2sd = V7, zscore= V9, no = V10)%>%
  dplyr::mutate(indicator = "WFH")

nut_motedu_wfa <- tbls[[52]]%>%
  slice(30:33) %>%
  dplyr::select(V1,V11:V14)%>%
  dplyr::rename(`Mother's education` = V1, perc_below3sd = V11, perc_below2sd = V12, zscore= V13, no = V14)%>%
  dplyr::mutate(indicator = "WFA")

nut_motedu <- dplyr::bind_rows(nut_motedu_hfa, nut_motedu_wfh, nut_motedu_wfa)
write_csv(nut_motedu, "table14_nutr_status_by_mother_edu.csv")

## by wealth
nut_wealth_hfa <- tbls[[52]]%>%
  slice(36:40) %>%
  dplyr::select(V1:V5)%>%
  dplyr::rename(`Wealth quintile` = V1, perc_below3sd = V2, perc_below2sd = V3, zscore= V4, no = V5)%>%
  dplyr::mutate(indicator = "HFA")

nut_wealth_wfh <- tbls[[52]]%>%
  slice(36:40) %>%
  dplyr::select(V1,V6,V7,V9,V10)%>%
  dplyr::rename(`Wealth quintile` = V1, perc_below3sd = V6, perc_below2sd = V7, zscore= V9, no = V10)%>%
  dplyr::mutate(indicator = "WFH")

nut_wealth_wfa <- tbls[[52]]%>%
  slice(36:40) %>%
  dplyr::select(V1,V11:V14)%>%
  dplyr::rename(`Wealth quintile` = V1, perc_below3sd = V11, perc_below2sd = V12, zscore= V13, no = V14)%>%
  dplyr::mutate(indicator = "WFA")

nut_wealth <- dplyr::bind_rows(nut_wealth_hfa, nut_wealth_wfh, nut_wealth_wfa)
write_csv(nut_wealth, "table14_nutr_status_by_wealth.csv")
```

### Table 14C: Nutritional status of children by county
```{r}
nutc_hfa <- tbls[[53]]%>%
  slice(5:51) %>%
  dplyr::select(V1:V5)%>%
  dplyr::rename(`County` = V1, perc_below3sd = V2, perc_below2sd = V3, zscore= V4, no = V5)%>%
  dplyr::mutate(indicator = "HFA")

nutc_wfh <- tbls[[53]]%>%
  slice(5:51) %>%
  dplyr::select(V1,V6,V7,V9,V10)%>%
  dplyr::rename(`County` = V1, perc_below3sd = V6, perc_below2sd = V7, zscore= V9, no = V10)%>%
  dplyr::mutate(indicator = "WFH")

nutc_wfa <- tbls[[53]]%>%
  slice(5:51) %>%
  dplyr::select(V1,V11:V14)%>%
  dplyr::rename(`County` = V1, perc_below3sd = V11, perc_below2sd = V12, zscore= V13, no = V14)%>%
  dplyr::mutate(indicator = "WFA")

nutc <- dplyr::bind_rows(nutc_hfa, nutc_wfh, nutc_wfa)
write_csv(nutc, "table14C_nutr_status_by_county.csv")
```

## 3.14	Infant and Young Child Feeding

### Table 15: Infant and young child feeding (IYCF) indicators
```{r}
iycf <- tbls[[59]]
```

## 3.15	Early Childhood Mortality

### Table 16: Early childhood mortality rates
```{r}
child_mort <- tbls[[61]]
```

### Table 17: Five-year early childhood mortality rates according to background characteristics
```{r}
child_mort5 <- tbls[[63]]
```

## 3.16: Malaria

### Table 18: Household possession of insecticide-treated nets
```{r}
itn_res <- tbls[[67]]%>%
  slice(5,6)%>%
  dplyr::rename(Residence = V1, perc_atleast_1itn = V2, avrg_itn_hh = V3, no_hhs= V4, perc_atleast_1itn_2pple= V5, no_hhs_1person_overnight=V6)

write_csv(itn_res, "table18_ITN_by_residence.csv")

itn_endem <- tbls[[67]]%>%
  slice(9:13)%>%
  dplyr::rename(`Endemicity zone` = V1, perc_atleast_1itn = V2, avrg_itn_hh = V3, no_hhs= V4, perc_atleast_1itn_2pple= V5, no_hhs_1person_overnight=V6)

write_csv(itn_endem, "table18_ITN_by_endemicity_zone.csv")

itn_wealth <- tbls[[67]]%>%
  slice(16:20)%>%
  dplyr::rename(`Wealth quintile` = V1, perc_atleast_1itn = V2, avrg_itn_hh = V3, no_hhs= V4, perc_atleast_1itn_2pple= V5, no_hhs_1person_overnight=V6)

write_csv(itn_wealth, "table18_ITN_by_wealth_quintile.csv")
```

### Table 18C: Household possession of insecticide-treated nets by county
```{r}
itnc <- tbls[[68]]%>%
  slice(4:50)%>%
  dplyr::rename(County = V1, perc_atleast_1itn = V2, avrg_itn_hh = V3, no_hhs= V4, perc_atleast_1itn_2pple= V5, no_hhs_1person_overnight=V6)

write_csv(itnc, "table18C_ITN_by_county.csv")
```



### Table 2C: Background xtics by county

```{r}
### women
women_background_xtics_county <- tbls[[6]]%>%
  slice(5:51)%>%
  select(V1:V4)%>%
  dplyr::rename(County = V1, weighted_perc = V2, weighted_no = V3, unweighted_no = V4)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga",
                       "Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

write_csv(women_background_xtics_county, "table2C_women_backgroundxtics_by_county.csv")

### men
men_background_xtics_county <- tbls[[6]]%>%
  slice(5:51)%>%
  select(V1,V5:V7)%>%
  dplyr::rename(County = V1, weighted_perc = V5, weighted_no = V6, unweighted_no = V7)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga",
                       "Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

write_csv(men_background_xtics_county, "table2C_men_backgroundxtics_by_county.csv")
```

### Table 10: Maternal care indicators by background xtics

```{r}
### Mother's age at birth
matcare_motage_1birth <- tbls[[33]]%>%
  slice(7:9)%>%
  select(V1:V5,V7,V8,V10)%>%
  dplyr::rename(`Mother's age at birth`=V1, ANC_skilled_provider=V2, `ANC4+`=V3, iron_supplements=V4, neonatal_tetanus_protection=V5, skilled_provider_delivery=V7, health_facility_delivery=V8, PNC_2days_afterbirth=V10)

write_csv(matcare_motage_1birth, "table10_maternalcare_by_motherage_atbirth.csv")

### Residence
matcare_residence <- tbls[[33]]%>%
  slice(12:13)%>%
  select(V1:V5,V7,V8,V10)%>%
  dplyr::rename(Residence=V1, ANC_skilled_provider=V2, `ANC4+`=V3, iron_supplements=V4, neonatal_tetanus_protection=V5, skilled_provider_delivery=V7, health_facility_delivery=V8, PNC_2days_afterbirth=V10)

write_csv(matcare_residence, "table10_maternalcare_by_residence.csv")

### Mother's education
matcare_motedu <- tbls[[33]]%>%
  slice(16:19)%>%
  select(V1:V5,V7,V8,V10)%>%
  dplyr::rename(`Mother's education`=V1, ANC_skilled_provider=V2, `ANC4+`=V3, iron_supplements=V4, neonatal_tetanus_protection=V5, skilled_provider_delivery=V7, health_facility_delivery=V8, PNC_2days_afterbirth=V10)

write_csv(matcare_motedu, "table10_maternalcare_by_education.csv")

### Wealth
matcare_wealth <- tbls[[33]]%>%
  slice(22:26)%>%
  select(V1:V5,V7,V8,V10)%>%
  dplyr::rename(`Wealth quintile`=V1, ANC_skilled_provider=V2, `ANC4+`=V3, iron_supplements=V4, neonatal_tetanus_protection=V5, skilled_provider_delivery=V7, health_facility_delivery=V8, PNC_2days_afterbirth=V10)

write_csv(matcare_wealth, "table10_maternalcare_by_wealth.csv")
```

### Table 12: Treatment for ARI symptoms, fever, & diarrhea

```{r}
### Age
treatment_symptoms_age_ARI <- tbls[[45]]%>%
  slice(6:11)
  
```

