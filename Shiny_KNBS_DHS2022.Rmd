---
title: "Kenya DHS 2022"
output: 
  flexdashboard::flex_dashboard:
    #theme:
    #  navbar-bg: "#A6674A"
    orientation: rows
    vertical_layout: scroll
runtime: shiny
    
---
<!-- <style>                      -->
<!-- .navbar { -->
<!--   background-color:#A6674A; -->
<!-- } -->


<!-- </style>    -->


```{r setup, include=FALSE}

# load all the required packages
library(pacman)
p_load(docxtractr)
p_load(flexdashboard)
p_load(tidyverse)
p_load(ggiraph)
p_load(scales)
p_load(sf)
p_load(reshape2)
# import all the tables
dhs2022report <- read_docx("2022KDHSKIR_KNBS.docx") 

# number of tables in the report
docx_tbl_count(dhs2022report)
tbls <- docx_extract_all_tbls(dhs2022report, trim = T, guess_header = T)

```

 {.tabset}
-----------------------------------------------------------------------

# Summary 

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("37,911"),
  caption = "All Households Interviewed",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("19,747"),
  caption = "Full questionnaires",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("18,164"),
  caption = "Short questionnaires",
  color = "darkgreen"
)
```

<br>

<br>



Column {data-width="600"}
---------------------------------

##### Choose the characteristics to display:

```{r}
radioButtons("quest", "",
             c("Households interviewed"="All",
               "Participants: Men"="Male",
               "Participants: Women"="Female"))

```


### Respondendents

```{r, fig.height=10,fig.height=22}
kdhshouseholdinterviews <- read_csv("table1_dhshhinterviews.csv") %>%
  dplyr::mutate(Households = recode(Households, "Households selected" = "Selected","Households occupied" = "Occupied", "Households interviewed" = "Interviewed"))

# include redundant columns in the household data to combine with the participant data
interviewvisuals <- kdhshouseholdinterviews %>%
  mutate(Gender="All") %>% 
  mutate(Participant="All") %>%
  rename(Respondents=Households)



## import data for participant interviews 
participantsinterviews <- read_csv("table1_participantsinterviews.csv") %>%
  dplyr::mutate(Participant = recode(Respondents, "Number of eligible women" = "Eligible women","Number of eligible women interviewed" = "Women interviewed", "Number of eligible men" = "Eligible men","Number of eligible men interviewed" = "Men interviewed"))

# join the two datasets
totalinterviewvisuals <- rbind(interviewvisuals ,participantsinterviews) %>%
  mutate(selection=recode(selection, "Long questionnaire"="Full questionnaires", "Long_questionnaire"="Full questionnaires"))

renderPlot({
 ggplot(totalinterviewvisuals[totalinterviewvisuals$Gender%in%input$quest,], aes(x=Respondents, y=numbers)) + 
  geom_bar(stat = "identity", position = position_dodge(), fill="#53A7DC") +
  theme_bw() +
  geom_text(aes(label=format(numbers, big.mark=",")), size=5,hjust=2, color="white")+scale_y_continuous(label=comma)+
  coord_flip() + labs(x="Households", y="", fill="Residence")+
  facet_grid(residence~selection) +
  theme(text= element_text(size = 20, colour = "black", face = "bold")) +
  theme(strip.background =element_rect(fill="grey80"))
        }, width = 1350, height=800) 
  


```




Indicators
================================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>


[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>


respondents_characteristics {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("32,156"),
  caption = "Number of women interviewed",
  color = "red",
  icon='fa-female,'
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("14,453"),
  caption = "Number of men interviewed",
  color = "darkgreen",
  icon='fa-male'
)
```

Column {data-width="600"}
-----------------------

#### Choose the characteristics to display:

```{r}

selectInput("char", "",
             c("Age"="Age",
               "Reported health status"="Health_Status",
               "Religion"="Religion",
               "Marital status"="Marital_Status",
               "Residence"="Residence",
               "Education Status"="Education_Status",
               "Wealth Quintile"="Wealth_Quintile",
               "By County"="County"))

```


```{r}

respondentsbyage <- read_csv("table2_ageparticipants.csv")%>%
  mutate(Indicator="Age")%>%
  rename(Grouping=Age)

# reported health status data
healthstatus <- read_csv("table2_selfreport_healthstatus.csv") %>%
  mutate(Health_status = fct_relevel(Health_status, 
            "Very bad","Bad","Moderate","Good","Very good"))%>%
  mutate(Indicator="Health_Status")%>%
  rename(Grouping=Health_status)

# religion
religionrespondents <- read_csv("table2_religionparticipants.csv") %>%
  mutate(Religion = fct_relevel(Religion, "Other","No religion", "Muslim","Catholic","Protestant/other Christian")) %>%
  mutate(Indicator="Religion") %>%
  rename(Grouping=Religion)

# Marital status
maritalstatusrespondents <- read_csv("table2_maritalstatusparticipants.csv") %>%
  mutate(Marital_status = fct_relevel(Marital_status, "Widowed","Living together", "Divorced/separated","Never married","Married")) %>% 
  mutate(Indicator="Marital_Status") %>%
  rename(Grouping=Marital_status)

# Place of residence 
residentrespondents <- read_csv("table2_residenceparticipants.csv") %>%
  mutate(Residence = fct_relevel(Residence, "Urban", "Rural")) %>%
  mutate(Indicator="Residence") %>%
  rename(Grouping=Residence)

# Education status
educationrespondents <- read_csv("table2_educationstatusparticipants.csv")  %>%
  mutate(Education_status = fct_relevel(Education_status, "Vocational", "More than secondary","Secondary", "Primary", "No education")) %>%
  mutate(Indicator="Education_Status") %>%
  rename(Grouping=Education_status)

# Wealth quintile
economicstatusrespondents <- read_csv("table2_economicstatus15_49.csv")  %>%
  mutate(Wealth_quintile = fct_relevel(Wealth_quintile, "Lowest", "Second","Middle", "Fourth", "Highest")) %>%
  mutate(Indicator="Wealth_Quintile") %>%
  rename(Grouping=Wealth_quintile)

# By county
countyrespondents <- read_csv("table2_participantsbycounty.csv") %>%
  arrange(desc(Weighted_percent)) %>%
  mutate(Indicator="County") %>%
  rename(Grouping=County)
  
# join the datasets with participants characteristics

respondentsdata <- rbind(respondentsbyage, healthstatus, religionrespondents, maritalstatusrespondents, residentrespondents, educationrespondents, economicstatusrespondents, countyrespondents) %>%
  mutate(Indicator1=Indicator) %>%
  mutate(Indicator1=recode(Indicator1, "Education_Status"="Education Status", "Health_Status"="Health Status", "Marital_Status"="Marital Status", "Wealth_Quintile"="Wealth Quintile"))

respondentsdata$Grouping <- fct_relevel(respondentsdata$Grouping, "Lowest", "Second", "Middle", "Fourth", "Highest")
# visualize the data
renderPlot({
  if (input$char%in%c("Wealth_Quintile", "Age")){
   respondentsdata%>%
    filter(Indicator==input$char)%>%
    ggplot(aes(x=Grouping, y=Weighted_percent, color = Participants)) + 
  geom_point(stat = "identity", size= 20) + 
  theme_bw() +
  geom_text(aes(label=paste0(Weighted_percent,"%")), hjust=-0.5, size=4, color="black")+
  labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") +scale_color_manual(values=c("darkgreen", "red"))+
  theme(text=element_text(size=18, face="bold"))}
    else {
     respondentsdata%>%
    filter(Indicator==input$char)%>%
    ggplot(aes(x=Grouping, y=Weighted_percent, fill = Participants)) + 
  geom_col(stat = "identity", size= 10) + 
  theme_bw() +
  geom_text(aes(label=Weighted_percent), vjust=-1.5, size=4, fill="black")+
  labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") +scale_fill_manual(values=c("darkgreen", "red"))+
  theme(text=element_text(size=20, face="bold")) 
    }
  }, width = 1420, height=700)
  


```

health_insurance {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"} 

<br>

### {.value-box}

```{r}

valueBox(
value = paste("26%"),
   caption = "Of women have a form of health insurance",
   color = "red", 
   icon='fa-female,' 
 ) 
``` 

### {.value-box}

```{r}
 valueBox( 
   value = paste("26.5%"), 
   caption = "Of men have a form of health insurance", 
   color = "darkgreen", 
   icon='fa-male' 
 )
 
```

Column {data-width="600"}
------------------------------- 

#### Choose characteristics to display:

```{r}

radioButtons("health", "",
              c("Age"="Age_category", 
                "Residence"="Residence", 
                "Wealth quintile"="Wealth_quintile"))

```

```{r }
# health insurance data by age
healthinsurancebyage <- read_csv("table3_healthinsurancebyage.csv") %>%
  tidyr::gather(Insurance,Coverage,2:7) %>%
  mutate(Insurance=recode(Insurance,"Any_health_insurance"="Form of health insurance", "None_DontKnow"="None/ Don't Know")) %>%
  rename(Indicator=Age_category) %>%
  mutate(Indicator1="Age_category")

# health insurance data by residence
healthinsurancebyresidence <-read_csv("table3_healthinsurancebyresidence.csv") %>%
  tidyr::gather(Insurance,Coverage,2:7) %>%
  mutate(Insurance=recode(Insurance,"Any_health_insurance"="Form of health insurance", "None_DontKnow"="None/ Don't Know")) %>%
  rename(Indicator=Residence) %>%
  mutate(Indicator1="Residence")

# Wealth quintile
healthinsurancebywealthquintile <- read_csv( "table3_healthinsurancebywealthquintile.csv") %>%
  tidyr::gather(Insurance,Coverage,2:7) %>%
  mutate(Insurance=recode(Insurance,"Any_health_insurance"="Form of health insurance", "None_DontKnow"="None/ Don't Know")) %>%
  rename(Indicator=Wealth_quintile) %>%
  mutate(Indicator1="Wealth_quintile")
  
# total health insurance data
healthinsurance <- rbind(healthinsurancebyage,healthinsurancebyresidence,healthinsurancebywealthquintile) %>%
  mutate(Insurance=recode(Insurance, "Community_based"="Community based", "Private_commercial"="Private/commercial"))

healthinsurance$Indicator <- fct_relevel(healthinsurance$Indicator, "Lowest", "Second", "Middle", "Fourth", "Highest")

healthinsurance$Insurance <- fct_relevel(healthinsurance$Insurance, "NHIF", "Private/commercial", "Community based", "Other", "Form of health insurance", "None/ Don't Know")

renderPlot({
  ggplot(healthinsurance[healthinsurance$Indicator1%in%input$health,], aes(x=Indicator, y=Coverage, fill=Participants))+geom_bar(stat = 'identity', position = position_dodge()) +
  facet_grid(.~Insurance)+labs(y="Proportion (%)")+
    scale_fill_brewer(palette = "Set1")+
    theme_bw()+theme(text=element_text(size=20, face = "bold"))
},width = 1420, height=650)


```

disability_pop {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}


### {.value-box}

```{r}

valueBox(
  value = paste("16%"),
  caption = "Some difficulty",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("5.2%"),
  caption = "Alot of difficulty",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("0.5%"),
  caption = "Cannot do anything at all",
  color = "darkgreen"
)
```


Column {data-width="600"}
-----------------------

##### Choose characteristics to display

```{r}

selectInput("disability", "Choose a category",
              c("Age"="Age_category", 
                "Marital Status"="Marital_status", 
                "Residence"="Residence",
                "Education"="Education_status",
                "Wealth quintile"="Wealth_quintile"))


selectInput("disability_domain", "Choose  a sub-indicator:",
              c("Seeing"="Seeing", 
                "Hearing"="Hearing", 
                "Communicating"="Communicating",
                "Remembering/Concentrating"="Remembering_concentrating","Walking/ClimbingSteps"="Walking_ClimbingSteps",
                "Washing all over/Dressing"="washingAllOver_dressing"))

```



```{r }
# disability by age
disabilitybyage <- read_csv( "table4_disabilitybyage.csv") %>%
  mutate(Indicator1 ="Age_category") %>%
  rename(Indicator=Age_category)

# disability by marital status
disabilitybymaritalstatus <- read_csv( "table4_disabilitybymaritalstatus.csv") %>%
  mutate(Indicator1="Marital_status") %>%
  rename(Indicator=Marital_status)

# disability by residence
disabilitybyresidence <- read_csv( "table4_disabilitybyresidence.csv") %>%
  mutate(Indicator1 = "Residence") %>%
  rename(Indicator=Residence)

# disability by education status
disabilitybyeducationstatus <- read_csv( "table4_disabilitybyeducationstatus.csv") %>%
  mutate(Indicator1 ="Education_status") %>%
  rename(Indicator=Education_status)
 
#disability by wealth quintile
disabilitybywealthquintile <- read_csv( "table4_disabilitybywealthquintile.csv") %>%
  mutate(Indicator1="Wealth_quintile") %>%
  rename(Indicator=Wealth_quintile)
  
disabilitydata <- rbind(disabilitybyage, disabilitybymaritalstatus, disabilitybyresidence, disabilitybyeducationstatus, disabilitybywealthquintile) %>%
  pivot_longer(c(No_difficulty, SomeDifficulty, A_lot_of_difficulty, Cannot_do_at_all, A_lot_of_difficulty_cannot_do_at_all, A_lot_of_difficulty_cannot_do_at_all_more_than_one_domain), names_to="difficulty", values_to="difficultyprop") %>%
  pivot_longer(c(Seeing, Hearing,Communicating, Remembering_concentrating, Walking_ClimbingSteps, WashingAllOver_dressing), names_to="impairment", values_to="impairmentvalues")%>%
  filter(difficulty%in%c("A_lot_of_difficulty","SomeDifficulty", "Cannot_do_at_all"))%>%
  mutate(difficulty=recode(difficulty, "A_lot_of_difficulty"="Alot of difficulty", "SomeDifficulty"="Some Difficulty","Cannot_do_at_all"="Cannot do at all"  ))%>%
  mutate(difficulty=fct_relevel(difficulty, "Some Difficulty", "Alot of difficulty", "Cannot do at all")) %>%
  mutate(Indicator2 =recode(Indicator1, "Age_category"="Age category", "Education_status"="Education status", "Marital_status"="Marital status", "Residence"="Residence", "Wealth_quintile"="Wealth quintile"))

disabilitydata$Indicator <- fct_relevel(disabilitydata$Indicator, "Lowest", "Second", "Middle", "Fourth", "Highest")

 renderPlot({
   ggplot(disabilitydata[disabilitydata$Indicator1==input$disability,], aes(x=Indicator, y=difficultyprop, fill=difficulty)) + 
  geom_bar(stat = "identity", position = position_dodge()) +
  scale_fill_manual("Disability", values = c("SomeDifficulty" = "darkorange", "A_lot_of_difficulty" = "cyan3", "Cannot_do_at_all" = "red")) +
  theme_bw() +
  labs(y="Percent (%)", x=paste0(unique(disabilitydata[disabilitydata$Indicator1==input$disability,]$Indicator2) ," of respondents"), fill="Disability") +
  theme(text=element_text(size=20, face="bold"))+
     scale_fill_brewer(palette="Set1") 
},width = 1420, height=600)
```

fertility {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("3.4"),
  caption = "Total Fertility Rate per woman (15-49)",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("122"),
  caption = "General fertility rate, expressed per 1,000 women age 15–44",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("27.7"),
  caption = "Crude birth rate, expressed per 1,000 population",
  color = "darkgreen"
)
```

<br>


Column {data-width="600"}
--------------------------

<!-- ### Fertility trends -->

<!-- ```{r} -->

<!-- trendstotalfertilityrate <- read_csv( "figure1_trendstotalfertilityrate.csv")%>% -->


<!-- renderPlot({ -->
<!--   ggplot(trendstotalfertilityrate, aes(x=Years, y=`Total Fertility Rate`, group=Residence, fill=Residence, color=Residence))+geom_line(size=1.5)+geom_point(size=1.7)+theme_bw()+labs(x="Age category", y="Rate per 1,000 women")+theme(text=element_text(size=20, face="bold"))+scale_fill_brewer(palette = "Set1")+scale_color_brewer(palette = "Set1") -->
<!-- }) -->
<!-- ``` -->

### Current fertility rates

```{r, fig.width=15, fig.height=8}



agespecificfertilityrate <- read_csv( "table5_agespecificfertilityrate.csv") %>%
  pivot_longer(c(Urban, Rural, Total), names_to="Residence", values_to="Residenceprop")%>%
  filter(Residence!="Total")%>%
  mutate(Residenceprop=recode(Residenceprop, "[0]"="0", "[2]"="2", "[3]"="3", "[7]"="7")) %>%
  mutate(Residenceprop=as.numeric(Residenceprop))


  ggplot(agespecificfertilityrate, aes(x=Age_category, y=Residenceprop))+geom_col(fill="#4C97C8")+facet_grid(Residence~.)+
    theme_bw()+labs(x="Age category", y="Rate per 1,000 women")+theme(text=element_text(size=20, face="bold"))



```

teenage_pregnancy {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("12.2%"),
  caption = "of women aged 15-19 have ever had a live birth",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("0.9%"),
  caption = "of women aged 14-19 have ever had a pregnancy loss",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("14.9%"),
  caption = "of women aged 14-19 have ever been pregnant",
  color = "darkgreen"
)
```

<br>

<br>

Column {data-width="600"}
--------------------------

```{r, fig.width=15, fig.height=9}
teenpregnancybycountyvisual <- read_csv("table6_teenpregnancybycounty.csv") %>%
  pivot_longer(cols = Live_birth:Ever_pregnant, names_to = "Pregnancy", values_to = "Percent") %>%
  mutate(Pregnancy=recode(Pregnancy, "Currently_pregnant"="Currently pregnant", "Ever_pregnant"="Ever pregnant", "Live_birth"="Live birth", "Pregnancy_loss"="Pregnancy loss"))

teenpregnancybycountyvisuals <- teenpregnancybycountyvisual %>%
  ggplot(aes(x=reorder(County,Percent), y=Percent, fill=Pregnancy)) + 
  geom_bar(stat = "identity") + #, position = position_dodge()) +
  #facet_wrap(facets = ~reorder(Participants, Percent)) +
  #scale_fill_manual("Residence", values = c("Urban" = "darkorange", "Rural" = "cyan3")) +
  theme_bw() +
  coord_flip() +
  ylab("Percent (%)") + xlab("County") +
  theme(text=element_text(size=20, face="bold")) +
  theme(strip.background =element_rect(fill="gray80")) +scale_fill_brewer(palette="Set1")
teenpregnancybycountyvisuals
  
```


nutr_status {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("17.6%"),
  caption = "Moderate stunting",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("4.9%"),
  caption = "Moderate wasting",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("10.1%"),
  caption = "Moderately underweight",
  color = "darkgreen"
)
```

<br>

Row {data-width="800"}
-------------------------------------

### Choose characteristics to display

```{r}

selectInput("nutr", "Choose background indicators to display:",
              c("Sex"="Sex", 
                "Residence"="Residence",
                "Mother's education"="Mother_education",
                "Wealth quintile"="Wealth_quintile"))

```


```{r}
#nut_age <- read_csv("table14_nutr_status_by_age.csv")%>%

nut_sex <- read_csv("table14_nutr_status_by_sex.csv")%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(lab = str_c(perc_below2sd,"%"))%>%
  mutate(Indicator1 ="Sex") %>%
  rename(Indicator=Sex)

nut_res <- read_csv("table14_nutr_status_by_residence.csv")%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(lab = str_c(perc_below2sd,"%"))%>%
  mutate(Indicator1 ="Residence") %>%
  rename(Indicator=Residence)

nut_motedu <- read_csv("table14_nutr_status_by_mother_edu.csv")%>%
  mutate(`Mother's education`=as.factor(fct_relevel(`Mother's education`, c("No education", "Primary", "Secondary", "More than secondary"))))%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(lab = str_c(perc_below2sd,"%"))%>%
  mutate(Indicator1 ="Mother_education") %>%
  rename(Indicator=`Mother's education`)

nut_wealth <- read_csv("table14_nutr_status_by_wealth.csv")%>%
  mutate(`Wealth quintile`=as.factor(fct_relevel(`Wealth quintile`, c("Lowest", "Second", "Middle", "Fourth", "Highest"))))%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(lab = str_c(perc_below2sd,"%"))%>%
  mutate(Indicator1 ="Wealth_quintile") %>%
  rename(Indicator=`Wealth quintile`)

nut_total <- rbind(nut_sex,nut_res,nut_motedu,nut_wealth)


renderPlot({
  if(input$nutr%in%c("Sex", "Residence")){
  ggplot(nut_total[nut_total$Indicator1%in%input$nutr,], aes(x=measure, y=perc_below2sd, fill=Indicator))+
  geom_bar(position="dodge", stat="identity")+
  theme_bw()+
  labs( y="% below -2 SD^2 (Moderate)", title="", x="Nutritional measure", fill="Residence")+
  scale_fill_manual(values = c("#f46d43","#74add1"))+
  theme(text=element_text(size=20, face="bold"))
  } else{
  ggplot(nut_total[nut_total$Indicator1%in%input$nutr,], aes(x=Indicator, y=perc_below2sd, fill=measure))+
  geom_dotplot(binaxis='y', stackdir='center', binwidth = 2)+
  theme_bw()+
  labs( y="% below -2 SD^2 (Moderate)", title="", x="Indicator", fill="")+
  scale_fill_manual(values = c("#f46d43","#fee090","#4575b4"))+
  theme(text=element_text(size=20, face="bold"))+
  geom_text(aes(label = lab), hjust=-1.0, size=4) 
}
},width = 1300, height=400)

```

Row {data-width="600"}
-------------------------------------

### Choose characteristics to display


```{r}
selectInput("nutr2", "",
              c("HFA"="HFA",
                "WFA"="WFA",
                "WFH"="WFH"))
```


```{r, include=FALSE}
nutc <- read_csv("table14C_nutr_status_by_county.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga",
                       "Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

county <- st_read("./Kenya County shapefiles/County.shp")%>%
  mutate(region=ifelse(Name%in%c("Kilifi","Kwale","Lamu", "Mombasa", "Taita Taveta", "Tana River"),"Coast", ifelse(Name%in%c("Garissa", "Mandera", "Wajir"),"North Eastern", ifelse(Name%in%c("Marsabit","Isiolo","Meru","Tharaka Nithi","Embu","Kitui","Machakos","Makueni"),"Eastern", ifelse(Name%in%c("Kiambu", "Kirinyaga","Muranga","Nyandarua", "Nyeri"),"Central", ifelse(Name%in%c("Bungoma",
 "Busia","Kakamega","Vihiga"),"Western", ifelse(Name%in%c("Kisumu", "Siaya","Homa Bay","Kisii", "Migori","Nyamira"),"Nyanza", ifelse(Name%in%"Nairobi","Nairobi", "Rift Valley"))))))))%>%
  rename(County=Name)
```





```{r}
nutc1 <- full_join(county, nutc, by="County")%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(names1=paste0(County,", ", perc_below3sd,"%","(",measure,")"))%>%
  mutate(names2=paste0(County,", ", perc_below2sd,"%","(",measure,")"))

renderGirafe({
  nut_map2 <- ggplot(nutc1[nutc1$indicator%in%input$nutr2,], aes(fill=perc_below2sd))+
    ggiraph::geom_sf_interactive(aes(tooltip = names2),size=0.3)+
    theme_void()+
    scale_fill_gradient(low = "white", high = "#8c2d04")+
    labs(x="", y="",fill="% below -2 SD^2 (Moderate)")+
    theme(text=element_text(size=14)) 
  nut_map2x<-girafe(ggobj = nut_map2,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)))
  print(nut_map2x)
})#,width = 1500, height=800)

```


### Nutritional status

```{r}
nutc1 <- full_join(county, nutc, by="County")%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(names1=paste0(County,", ", perc_below3sd,"%","(",measure,")"))%>%
  mutate(names2=paste0(County,", ", perc_below2sd,"%","(",measure,")"))

renderGirafe({
  nut_map1 <- ggplot(nutc1[nutc1$indicator%in%input$nutr2,], aes(fill=perc_below3sd))+
    ggiraph::geom_sf_interactive(aes(tooltip = names1),size=0.3)+
    theme_void()+
    scale_fill_gradient(low = "white", high = "#8c2d04")+
    labs(x="", y="",fill=" % below -3 SD (Severe)")+
    theme(text=element_text(size=14)) 
  nut_map1x<-girafe(ggobj = nut_map1,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)))
  print(nut_map1x)
})#,width = 1500, height=800)
```


treated_nets {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("54.2%"),
  caption = "Households with at least 1 insecticide treated net",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("1.2"),
  caption = "Average number of insecticide treated nets per household",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("37.1%"),
  caption = "Households with at least 1 insecticide treated net\n per 2 persons who stayed last night",
  color = "darkgreen"
)
```

<br>



### Choose indicators to display

```{r}

```


home_ownership {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("4.5%"),
  caption = "Of women own a house alone",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("36.3%"),
  caption = "Of men own a house alone",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("9.4%"),
  caption = "Of women who own houses have their names on the title deed",
  color = "darkgreen"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("12.2%"),
  caption = "Of men who own houses have their names on the title deed",
  color = "darkblue"
)
```

<br>

Row {data.width=600}
-------------------------------------


#### House ownership

```{r}

selectInput("home_own", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="residence",
                "Wealth quintile"="wealth"))

men_title_deed <- read_csv('table_27.2_house_has_a_title_deed.csv') %>%
  mutate(Participant = 'Male')
men_title_deed <- subset (men_title_deed, select = -Number)
names(men_title_deed) <- gsub("\\.", " ", names(men_title_deed))



percentage_own_house_men <- read_csv('table_27.2_percentage_who_own_a_house.csv')%>%
  mutate(Participant = 'Male')
percentage_own_house_men <- subset (percentage_own_house_men, select = -Number)
names(percentage_own_house_men) <- gsub("\\.", " ", names(percentage_own_house_men))


women_title_deed <- read_csv('table_27.1_house_has_a_title_deed.csv')%>%
  mutate(Participant = 'Female')
women_title_deed <- subset (women_title_deed, select = -Number)
names(women_title_deed) <- gsub("\\.", " ", names(women_title_deed))

percentage_own_house_women <- read_csv('table_27.1_percentage_who_own_a_house.csv')%>%
  mutate(Participant = 'Female')
percentage_own_house_women <- subset (percentage_own_house_women, select = -Number)
names(percentage_own_house_women) <- gsub("\\.", " ", names(percentage_own_house_women))


#-----age starts here
men_title_deed_age <- men_title_deed [c(2:8),c(0:6)]
women_title_deed_age <- women_title_deed[c(2:8),c(0:6)]


title_deed_age <-rbind(men_title_deed_age, women_title_deed_age)

title_deed_age <-melt(title_deed_age, id =c("Background Characteristic","Participant")) %>%
  mutate(indicator="Age")

## education

men_title_deed_education <- men_title_deed[c(15:18),c(0:6)]
women_title_deed_education <- women_title_deed[c(15:18),c(0:6)]


title_deed_education <-rbind(men_title_deed_education, women_title_deed_education)

title_deed_education  <-melt(title_deed_education,id =c("Background Characteristic","Participant")) %>%
  mutate(indicator="Education")

## residence
men_title_deed_residence <- men_title_deed[c(11:12),c(0:6)]
women_title_deed_residence <- women_title_deed[c(11:12),c(0:6)]


title_deed_residence <-rbind(men_title_deed_residence, women_title_deed_residence)

title_deed_residence  <-melt(title_deed_residence,id =c("Background Characteristic","Participant")) %>%
  mutate(indicator="residence")

# wealth

men_title_deed_wealth <- men_title_deed[c(21:25),c(0:6)]
women_title_deed_wealth <- women_title_deed[c(21:25),c(0:6)]


title_deed_wealth <-rbind(men_title_deed_wealth, women_title_deed_wealth)

title_deed_wealth  <-melt(title_deed_wealth,id =c("Background Characteristic","Participant")) %>%
  mutate(indicator="wealth")

# combine the data
title_deed_data <- rbind(title_deed_age, title_deed_education, title_deed_residence, title_deed_wealth)

renderPlot({ggplot(title_deed_data[title_deed_data$indicator%in%input$home_own,]) + 
  geom_col(mapping = aes(y = `Background Characteristic`, x=value, fill = Participant), position = 'dodge')+
  scale_colour_discrete(name="Own Title Deed")+
  xlim(0,100)+
  theme_bw()+
  labs(x ='Percentage (%)', y =paste0(title_deed_data[title_deed_data$indicator%in%input$home_own,]$indicator, " of respondents"), fill="Own Title Deed")+
  facet_grid(.~variable) +
  coord_flip()+theme(text = element_text(size=16, face="bold"))}, width=1500, height=800)

```




agric_land_ownership {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("3.1%"),
  caption = "Of women own agricultural land alone",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("26.2%"),
  caption = "Of men own agricultural land alone",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("13.4%"),
  caption = "Of women who own agricultural land /n have their names on the title deed",
  color = "darkgreen"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("23.3%"),
  caption = "Of men who own agricultural land /n have their names on the title deed",
  color = "darkblue"
)
```

<br>

Column {data.height=800}
-------------------------

#### Agricultural land ownership

```{r, message=F}

selectInput("agric_own", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="wealth quintile"))

```

```{r, include=F}
# agricultural land ownership

# load data
table28.1a <- read.csv('table_28.1_percentage_who_own_land.csv', encoding="UTF-8")  %>% 
  mutate(Participants='Women')
table28.1b<- read.csv('table_28.1_land_has_title_deed.csv', encoding="UTF-8") %>% 
  mutate(Participants='Women')
table28.2a <- read.csv('table_28.2_percentage_who_own_land.csv', encoding="UTF-8") %>% 
  mutate(Participants='Men')
table28.2b <- read.csv('table_28.2_land_has_title_deed.csv', encoding="UTF-8")  %>% 
  mutate(Participants='Men')
table28.3a <- read.csv('table_28.3_percentage_who_own_land.csv', encoding="UTF-8") %>% 
  mutate(Participants='Women')
table28.3b <- read.csv('table_28.3_land_has_a_title_deed.csv', encoding="UTF-8")%>%   
  mutate(Participants='Women')
table28.4a <- read.csv('table_28.4_percentage_who_own_land.csv', encoding="UTF-8") %>% 
  mutate(Participants='Men')
table28.4b <- read.csv('table_28.4_land_has_title_deed.csv', encoding="UTF-8")  %>% 
  mutate(Participants='Men')

county <- st_read("Kenya County shapefiles/County.shp")


table28a <- dplyr::bind_rows(table28.1a, table28.2a) 
table28b <- dplyr::bind_rows(table28.1b, table28.2b) 
table28c <- dplyr::bind_rows(table28.3a, table28.4a) 
table28d <- dplyr::bind_rows(table28.3b, table28.4b) 

table28a <- table28a %>%
  melt(id = c("Background.characteristic", "Indicator", "Participants")) %>%
  mutate(value = as.numeric(value)) %>%
  mutate(variable=recode(variable, "Both.alone.and.jointly"="Both alone & jointly", "Percentage.who.do.not.own.land"="Percentage who do not own land")) %>%
  dplyr::filter(!variable%in%c("Total", "Number"))

```

```{r}
renderPlot({ggplot(table28a[table28a$variable!=c("Total", "Number") &table28a$Background.characteristic%in%input$agric_own,],mapping=aes(y=value, x=Indicator, fill=Participants)) +
  geom_col(position="dodge") + 
  facet_wrap(~variable) + 
  theme_bw() +
  labs( x = paste0(unique(table28a[table28a$variable!=c("Total", "Number") &table28a$Background.characteristic%in%input$agric_own,]$Background.characteristic), " of respondents"), y="%", fill="Land Ownership")+theme(text=element_text(size=20, face="bold"))}, width=1500, height=400)

```

##### Agricultural land documentation

```{r}
selectInput("agric_doc", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="wealth quintile"))


table28b <- table28b %>%
  melt(id = c("Background.characteristic", "Indicator", "Participants")) %>%
  mutate(value = as.numeric(value)) %>%
  mutate(variable=recode(variable, "name.is.on.title.deed"="Name is on title deed", "name.is.not.on.title.deed"="Name is not on title deed", "Does.not.have.a.title.deed"="Does not have a title deed", "Don.t.know"="Don't know")) %>%
  dplyr::filter(!variable%in%c("Total", "Number"))


renderPlot({ggplot(table28b[table28b$variable!=c("Total", "Number") &table28b$Background.characteristic%in%input$agric_doc,], mapping=aes(y=value, x=Indicator, fill=Participants)) +
  geom_col(position="dodge") +
  facet_wrap(~variable) +
  theme_bw() +
  labs( x = paste0(unique(table28b[table28b$Background.characteristic%in%input$agric_doc,]$Background.characteristic), " of respondents"), y="%", fill="")+theme(text=element_text(size=16, face="bold"))
},width=1500, height=400)
```

nonagric_land_ownership {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#HIV_prevention)</br>

[Coverage of prior HIV testing](#HIV_testing)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Physical violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("1.4%"),
  caption = "Of women own non-agricultural land alone",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("7.0%"),
  caption = "Of men own non-agricultural land alone",
  color = "red"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("30.8%"),
  caption = "Of women who own non-agricultural land /n have their names on the title deed",
  color = "darkgreen"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("47.9%"),
  caption = "Of men who own non-agricultural land /n have their names on the title deed",
  color = "darkblue"
)
```

Column {data.height=800}
-------------------------


#### Non-agricultural land ownership 

```{r}
selectInput("nonagric_doc", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="wealth quintile"))



table28c<-table28c %>%
  melt(id = c("Background.characteristic", "Indicator", "Participants")) %>%
  mutate(value = as.numeric(value)) %>%
  mutate(variable=recode(variable, "Both.alone.and.jointly"="Both alone & jointly", "Percentage.who.do.not.own.land"="Do not own land")) %>%
  dplyr::filter(!variable%in%c("Total", "Number"))
 
renderPlot({ggplot(table28c[table28c$variable!=c("Total", "Number") &table28c$Background.characteristic%in%input$nonagric_doc,], mapping=aes(y=value, x=Indicator, fill=Participants)) +
  geom_col(position="dodge") +
  facet_wrap(~variable) +
  theme_bw() +
  labs( x = paste0(unique(table28c[table28c$Background.characteristic%in%input$nonagric_doc,]$Background.characteristic), " of respondents"), y="%", fill="")+theme(text=element_text(size=16, face="bold"))
},width=1500, height=400)

```

##### Non-agricultural land documentation

```{r}
selectInput("nonagric_doc1", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="wealth quintile"))

table28d <-table28d %>%
  melt(id = c("Background.characteristic", "Indicator", "Participants")) %>%
  mutate(value = as.numeric(value)) %>%
  mutate(variable=recode(variable, "Both.alone.and.jointly"="Both alone & jointly", "Percentage.who.do.not.own.land"="Do not own land")) %>%
  dplyr::filter(!variable%in%c("Total", "Number"))


renderPlot({ggplot(table28d[table28d$variable!=c("Total", "Number") &table28d$Background.characteristic%in%input$nonagric_doc1,], mapping=aes(y=value, x=Indicator, fill=Participants)) +
  geom_col(position="dodge") +
  facet_wrap(~variable) +
  theme_bw() +
  labs( x = paste0(unique(table28d[table28d$Background.characteristic%in%input$nonagric_doc1,]$Background.characteristic), " of respondents"), y="%", fill="")+theme(text=element_text(size=16, face="bold"))
},width=1500, height=400)
```

<br>

Column {data.height=800}
-------------------------

Compare indicators by county
============

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>



```{r}

### datasets

#nutrition
nutc <- read_csv("table14C_nutr_status_by_county.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

#ITN
itnc <- read_csv("table18C_ITN_by_county.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

#family planning
fpc <- read_csv("table8c_fpusemarriedbycounty.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

#teenage pregnancy
teenpregc <- read_csv("table6_teenpregnancybycounty.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

#violence
violencec <- read_csv("./table_29C-Experience_of_physical_violence_by_county/table_29C_Women.csv")%>% 
  rename(County=`Background characteristic`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))%>%
  dplyr::filter(!County%in%c("Total",NA))

#maternal care  
matcarec <- read_csv("./Edwin Tables/table10Cmaternalcarecounty.csv")%>% 
  rename(County=`NAME_1`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

#vaccination 
vacc <- read_csv("./Edwin Tables/table11C_vaccinationbycounty.csv")%>% 
  rename(County=`NAME_1`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))%>%
  mutate(CountyFullyVaccinated24=round(as.numeric(CountyFullyVaccinated24)))

#hiv knowledge
hivc <- read_csv("./Edwin Tables/table23_hiv_count_data.csv")%>% 
  #rename(County=`NAME_1`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

#hiv testing
hiv_testc <- read_csv("./Edwin Tables/table25C .1 and .2_HIV_test_bind.csv")%>% 
  #rename(County=`NAME_1`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

## combine datasets
comb <- nutc%>%left_join(itnc, by="County")%>%
  left_join(fpc, by="County")%>%
  left_join(teenpregc, by="County")%>%
  left_join(violencec, by="County")%>%
  left_join(matcarec, by="County")%>%
  left_join(vacc, by="County")%>%
  left_join(hivc, by="County")%>%
  left_join(hiv_testc, by="County")%>%
  mutate(lab=County)
```

hiv_test_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```

hiv_prevent_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```


contraceptive_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```


maternal_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```

vaccine_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```

nutrition_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```

fp_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```

teen_preg_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```

itn_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```

violence_county_comp {.hidden}
==================

Priority indicators {.sidebar}
-----------------------------------
<br>

[Coverage of prior HIV testing](#hiv_test_county_comp)</br>

[Knowledge about HIV prevention methods among young people](#hiv_prevent_county_comp)</br>

[Current contraceptive use](#contraceptive_county_comp)</br>

[Maternal care indicators](#maternal_county_comp)</br>

[Childhood vaccination coverage](#vaccine_county_comp)</br>

[Children nutritional status](#nutrition_county_comp)</br>

[Family planning need and demand](#fp_county_comp)</br>

[Teenage pregnancy](#teen_preg_county_comp)</br>

[Household possession of ITNs](#itn_county_comp)</br>

[Experience of physical violence](#violence_county_comp)</br>

## Row {data-width="200"}

<br>

## Row {data-height="200"}

```{r}
selectInput("comp", "Choose indicator to compare against:",
              c("Coverage of prior HIV testing"="Ind1", 
                "Knowledge about HIV prevention methods among young people"="Ind2",
                "Current contraceptive use"="Ind3",
                "Maternal care indicators"="Ind4",
                "Childhood vaccination coverage"="Ind5",
                "Children nutritional status"="Ind6",
                "Family planning need and demand"="Ind7",
                "Teenage pregnancy"="Ind8",
                "Household possession of ITNs"="Ind9",
                "Experience of physical violence"="Ind10"))
```